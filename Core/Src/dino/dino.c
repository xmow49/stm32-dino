#include "stm32f1xx_hal.h"
// #include "stm32f1xx_nucleo.h"
#include "lib/stm/stm32f1_uart.h"
// #include "stm32f1_sys.h"
#include "macro_types.h"
#include "lib/stm/stm32f1_gpio.h"
#include <stdint.h>
#include <lib/tft_ili9341/stm32f1_ili9341.h>

void writeLED(bool_e b)
{
	HAL_GPIO_WritePin(LED_GREEN_GPIO, LED_GREEN_PIN, b);
}

bool_e readButton(void)
{
	return HAL_GPIO_ReadPin(BLUE_BUTTON_GPIO, BLUE_BUTTON_PIN);
}

const unsigned short Dinosaure[440] = {
	0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x8d08, 0x8d08, 0x8d08, 0x8d08, // 0x0010 (16)
	0x9de9, 0x9de9, 0x9de9, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x9de9, // 0x0020 (32)
	0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, // 0x0030 (48)
	0x769f, 0x769f, 0x8d08, 0x9de9, 0xffff, 0x10a2, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x769f, 0x769f, 0x769f, 0x769f, // 0x0040 (64)
	0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, // 0x0050 (80)
	0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, // 0x0060 (96)
	0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x9de9, // 0x0070 (112)
	0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, // 0x0080 (128)
	0x769f, 0x769f, 0x8d08, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, // 0x0090 (144)
	0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x769f, 0x769f, // 0x00a0 (160)
	0x8d08, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x769f, 0x769f, // 0x00b0 (176)
	0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x9de9, 0x9de9, 0x9de9, // 0x00c0 (192)
	0x9de9, 0x9de9, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x9de9, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x8d08, // 0x00d0 (208)
	0x8d08, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x8d08, 0x8d08, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x9de9, 0x9de9, 0x769f, // 0x00e0 (224)
	0x769f, 0x8d08, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0xddd2, 0x769f, 0x8d08, 0x769f, 0x769f, 0x769f, 0x769f, // 0x00f0 (240)
	0x8d08, 0x8d08, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0xddd2, 0xfeb5, 0xfeb5, 0x769f, 0x769f, // 0x0100 (256)
	0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x8d08, 0x8d08, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0x9de9, 0xddd2, 0xfeb5, // 0x0110 (272)
	0xfeb5, 0xfeb5, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x8d08, 0x8d08, 0x8d08, 0x9de9, 0x9de9, 0x9de9, // 0x0120 (288)
	0x9de9, 0xddd2, 0xfeb5, 0xfeb5, 0xfeb5, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x8d08, // 0x0130 (304)
	0x8d08, 0x8d08, 0x9de9, 0x9de9, 0x9de9, 0xddd2, 0xfeb5, 0xfeb5, 0xfeb5, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, // 0x0140 (320)
	0x769f, 0x769f, 0x769f, 0x8d08, 0x8d08, 0x8d08, 0x8d08, 0x9de9, 0x9de9, 0xddd2, 0xfeb5, 0xfeb5, 0x769f, 0x769f, 0x769f, 0x769f, // 0x0150 (336)
	0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x8d08, 0x8d08, 0x8d08, 0x8d08, 0x8d08, 0xddd2, 0x769f, // 0x0160 (352)
	0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x8d08, 0x8d08, // 0x0170 (368)
	0x769f, 0x8d08, 0x8d08, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, // 0x0180 (384)
	0x769f, 0x8d08, 0x8d08, 0x769f, 0x769f, 0x769f, 0x8d08, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, // 0x0190 (400)
	0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, // 0x01a0 (416)
	0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x8d08, 0x8d08, 0x769f, 0x769f, 0x769f, 0x8d08, 0x8d08, // 0x01b0 (432)
	0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f};

int dino(void)
{
	// Initialisation de l'UART2 � la vitesse de 115200 bauds/secondes (92kbits/s) PA2 : Tx  | PA3 : Rx.
	// Attention, les pins PA2 et PA3 ne sont pas reli�es jusqu'au connecteur de la Nucleo.
	// Ces broches sont redirig�es vers la sonde de d�bogage, la liaison UART �tant ensuite encapsul�e sur l'USB vers le PC de d�veloppement.
	//	UART_init(UART2_ID, 115200);

	//"Indique que les printf sortent vers le p�riph�rique UART2."
	//	SYS_set_std_usart(UART2_ID, UART2_ID, UART2_ID);

	// Initialisation du port de la led Verte (carte Nucleo)
	BSP_GPIO_PinCfg(LED_GREEN_GPIO, LED_GREEN_PIN, GPIO_MODE_OUTPUT_PP, GPIO_NOPULL, GPIO_SPEED_FREQ_HIGH);

	// Initialisation du port du bouton bleu (carte Nucleo)
	BSP_GPIO_PinCfg(BLUE_BUTTON_GPIO, BLUE_BUTTON_PIN, GPIO_MODE_INPUT, GPIO_PULLUP, GPIO_SPEED_FREQ_HIGH);

	ILI9341_Init();
	ILI9341_Fill(0x769f);
	ILI9341_DrawFilledRectangle(0, 168, 320, 240, 0xf6b2);
	ILI9341_putBitmap(77, 124, 20, 22, 2, Dinosaure, 20 * 22);

	while (1)
	{
		if (!readButton())
		{
			for (int i = 124; i > 100; i--)
			{
				ILI9341_DrawFilledRectangle(77, i - 2 * 22, 77 + (20 * 2), 124 - (22 * 2), 0x769f);
				ILI9341_putBitmap(77, i, 20, 22, 2, Dinosaure, 20 * 22);
			}
		}
	}
}
